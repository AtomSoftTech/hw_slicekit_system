L2 Slicekit Core Board
======================

This board contains the XMOS device plus support circuitry to form the core of the system.

A single L2 device is be present which has all of its IO connected to the Slots. Additional Slicekit Core Boards can be connected to the Square Slot to add extra processing capability and IO through extra Slice Cards.

For debugging, an XSYS adaptor board is connected to the Chain Connector to allow connection of an XTAG2 to provide a debug link from a USB host.

The Slicekit Core Board is powered by a 12V external power supply.

The following sections describe the features of the Slicekit Core Board.

Power
-----

Power input to the Slicekit Core Board is via a standard barrel jack connector. A standard 12V external power supply should be used to power the board. Each Sliekit Core Board requires its own +12V supply.

The input supply is used to generate the main +5V board supply via a DC-DC converter.

The main +5V board supply is then fed to all the Slot connectors as well as powering the Slicekit Core Board itself. 3V3 and 1V0 supplies will be generated by DC-DC converters from the 5V main supply. 

The supplies are sequenced to ensure the power up sequence will be 5V then 3V3 then 1V0. When the 1V0 supply is good then the system will be released from reset.

The Slicekit Core Board will provide 3V3 and 5V at 0.25A each for a total of approx 2W per slice.

Debug
-----

Debug of the system will be via the XSYS adapter board connected to the Chain Connector.

The JTAG signals will be connected as shown in Figure 1. 

Presence detect signals are present on both the Chain Connector and Square Slot connectors to allow detection of a connected board and subsequent automatic switching of the JTAG chain. 

In a system of multiple Slicekit Core Boards, the master will be the source of the JTAG chain so the system can only be debugged from the master. Other boards will see no devices in the JTAG chain.

.. image:: images/jtagchain.png

The use of XScope is covered in the XMOS Links section. The XScope XMOS Link can be either enabled or disabled via a switch on the XTAG2 adapter board.

L2 Boot
+++++++

Master Slicekit Core Boards will boot from SPI flash. Slave Core Boards will boot from XLB from the next connected Core Board. 

To allow re-use of the SPI boot pins as signal IO pins, a latched bus switch is used which connects the XCore SPI pins to either the SPI Flash or to the Slice Card Slots.

The switch is controlled by X0D42 and X0D43 (P8D6 and P8D7 on Tile 0). Once the device has booted X0D43 is used to enable or disable the SPI interface, X0D42 should then transistion from low to high to latch the selection.

.. image:: images/spiselectflow.png

The SPI selection state is then maintained until the system is reset.

The XTAG2 system can use the boot mode select signal to force all devices in the chain (master and slave Core Boards) to boot from JTAG (don't boot) for debug purposes. 
If not in this mode, the devices will boot from SPI or XMOS Link as appropriate.

XMOS Links
++++++++++

The Chain Connector contains two 5-bit XMOS Links, XLA and XLB, which can be used for chaining Slicekit Core Boards together. The links from Tile 0 are connected to the Chain Connector and the Star Slot. 
The links from Tile 1 are connected to the Square Slot. 

The only complication in this system is use of the XScope 2-bit XMOS Link. This link overlaps a 4 bit port on the Star Slot connector so it would not be possible to use this for user IO at the same time as XScope. 
To work around this, a switch is present on the XTAG2 adapter board to either enable or disable the XScope XMOS Link. 
When disabled, these pins are disconnected from anything on the Chain Connector and are free for use on the Star Slot. When enabled they will work as an XMOS link and hence will appear on the relevant pins of the Star Slot. 

It is therefore recommended that if a Slice Card is used in the Star Slot the XScope switch is off to ensure correct operation of the Slice Card.

Reset
+++++

The whole system is held in reset until all power supplies are stable. This system reset is connected to all Slice Cards so any circuitry on them can be reset. 
It also indicates to the Slice Cards that their power input is stable.

The reset from the XTAG2 resets the whole system if required for debugging.

Clocking
++++++++

There are two sources for the system clock: an on-board 25MHz oscillator or the CLK signal from the Chain Connector. The system clock source is selected automatically.

This means the system clock from the master Core Board will be fed to all of the slave Core Boards so the whole system will operate synchronously.

The system clock is also fed to each of the Slice Cards.

Testpoints
++++++++++

Each xCore IO signal is also available on a 0.1" header, next to the Slot that it is connected to. 
These connections can be used to connect an oscilloscope or logic analyser, or for interconnection of signals for advanced development work.

The signals are identified on the silkscreen layer of the Slicekit Core Board, the table below lists their relationship to the internal ports.

======== ======== ======== ======== ======== ======== ======== ========
 L2 Pin   Slot     PCIE     Function
-------- -------- -------- -------------------------------------------- 
======== ======== ======== ======== ======== ======== ======== ========
 X0D0     TRI      B2       P1A0
 X0D1     STAR     A8       P1B0
          CHAIN    B10      
 X0D2     STAR     B6                P4A0     P8A0     P16A0    P32A20
          CHAIN    A7
 X0D3     STAR     B7                P4A1     P8A1     P16A1    P32A21
          CHAIN    A6
 X0D4     STAR     B9                P4B0     P8A2     P16A2    P32A22
          CHAIN    A11
 X0D5     STAR     B11               P4B1     P8A3     P16A3    P32A23
          CHAIN    A9
 X0D6     STAR     A9                P4B2     P8A4     P16A4    P32A24
          CHAIN    B11
 X0D7     STAR     A11               P4B3     P8A5     P16A5    P32A25
          CHAIN    B9
 X0D8     STAR     A6                P4A2     P8A6     P16A6    P32A26
          CHAIN    B7
 X0D9     STAR     A7                P4A3     P8A7     P16A7    P32A27
          CHAIN    B6
 X0D10    STAR     B10      P1C0
          CHAIN    A8
 X0D11    TRI      B4       P1D0
 X0D12    TRI      A3       P1E0
 X0D13    STAR     A15      P1F0
          CHAIN    B15
 X0D14    STAR     B12               P4C0     P8B0     P16A8    P32A28
          CHAIN    A13
 X0D15    STAR     B13               P4C1     P8B1     P16A9    P32A29
          CHAIN    A12
 X0D16    STAR     B17               P4D0     P8B2     P16A10
          CHAIN    A18
 X0D17    STAR     B18               P4D1     P8B3     P16A11
          CHAIN    A17
 X0D18    STAR     A17               P4D2     P8B4     P16A12
          CHAIN    B18
 X0D19    STAR     A18               P4D3     P8B5     P16A13
          CHAIN    B17
 X0D20    STAR     A12               P4C2     P8B6     P16A14   P32A30
          CHAIN    B13
 X0D21    STAR     A13               P4C3     P8B7     P16A15   P32A31
          CHAIN    B12
 X0D22    STAR     B15      P1G0
          CHAIN    A15
 X0D23    TRI      A4       P1H0
 X0D24    TRI      B15      P1I0
 X0D25    TRI      A8       P1J0
 X0D26    TRI      B6                P4E0     P8C0     P16B0
 X0D27    TRI      B7                P4E1     P8C1     P16B1
 X0D28    TRI      B9                P4F0     P8C2     P16B2
 X0D29    TRI      B11               P4F1     P8C3     P16B3
 X0D30    TRI      A9                P4F2     P8C4     P16B4
 X0D31    TRI      A11               P4F3     P8C5     P16B5
 X0D32    TRI      A6                P4E2     P8C6     P16B6
 X0D33    TRI      A7                P4E3     P8C7     P16B7
 X0D34    TRI      B10      P1K0
 X0D35    TRI      A15      P1L0
 X0D36    TRI      B12      P1M0              P8D0     P16B8
 X0D37    TRI      B13      P1N0              P8D1     P16B9
 X0D38    TRI      B17      P1O0              P8D2     P16B10
 X0D39    TRI      B18      P1P0              P8D3     P16B11
 X0D40    TRI      A17                        P8D4     P16B12
 X0D41    TRI      A18                        P8D5     P16B13
 X0D42    TRI      A12                        P8D6     P16B14
 X0D43    TRI      A13                        P8D7     P16B15
 X1D0     CIRC     B2       P1A0
 X1D1     SQU      A8       P1B0
 X1D2     SQU      B6                P4A0     P8A0     P16A0    P32A20
 X1D3     SQU      B7                P4A1     P8A1     P16A1    P32A21
 X1D4     SQU      B9                P4B0     P8A2     P16A2    P32A22
 X1D5     SQU      B11               P4B1     P8A3     P16A3    P32A23
 X1D6     SQU      A9                P4B2     P8A4     P16A4    P32A24
 X1D7     SQU      A11               P4B3     P8A5     P16A5    P32A25
 X1D8     SQU      A6                P4A2     P8A6     P16A6    P32A26
 X1D9     SQU      A7                P4A3     P8A7     P16A7    P32A27
 X1D10    SQU      B10      P1C0
 X1D11    CIRC     B4       P1D0
 X1D12    CIRC     A3       P1E0
 X1D13    SQU      A15      P1F0
 X1D14    SQU      B12               P4C0     P8B0     P16A8    P32A28
 X1D15    SQU      B13               P4C1     P8B1     P16A9    P32A29
 X1D16    SQU      B17               P4D0     P8B2     P16A10
 X1D17    SQU      B18               P4D1     P8B3     P16A11
 X1D18    SQU      A17               P4D2     P8B4     P16A12
 X1D19    SQU      A18               P4D3     P8B5     P16A13
 X1D20    SQU      A12               P4C2     P8B6     P16A14   P32A30
 X1D21    SQU      A13               P4C3     P8B7     P16A15   P32A31
 X1D22    SQU      B15      P1G0
 X1D23    CIRC     A4       P1H0
 X1D24    CIRC     B15      P1I0
 X1D25    CIRC     A8       P1J0
 X1D26    CIRC     B6                P4E0     P8C0     P16B0
 X1D27    CIRC     B7                P4E1     P8C1     P16B1
 X1D28    CIRC     B9                P4F0     P8C2     P16B2
 X1D29    CIRC     B11               P4F1     P8C3     P16B3
 X1D30    CIRC     A9                P4F2     P8C4     P16B4
 X1D31    CIRC     A11               P4F3     P8C5     P16B5
 X1D32    CIRC     A6                P4E2     P8C6     P16B6
 X1D33    CIRC     A7                P4E3     P8C7     P16B7
 X1D34    CIRC     B10      P1K0
 X1D35    CIRC     A15      P1L0
 X1D36    CIRC     B12      P1M0              P8D0     P16B8
 X1D37    CIRC     B13      P1N0              P8D1     P16B9
 X1D38    CIRC     B17      P1O0              P8D2     P16B10
 X1D39    CIRC     B18      P1P0              P8D3     P16B11
======== ======== ======== ======== ======== ======== ======== ========

Slot pinouts
++++++++++++

The signal assignments for the connectors on the Core Board and Slice Cardss can be seen in the table below.

[TODO pinout table] 


Slot signal notes
~~~~~~~~~~~~~~~~~

On all Slots, TDO is always out of the Slicekit Core Board, TDI is always in to the Core Board.

MSEL, TCK, TMS, RST_N are all inputs to the core board from the Chain Connecotr and outputs from the Core Board on the Square Slot .
DEBUG is bidirectional.

PRSNT is used on the Chain Connector to detect it is plugged into the Square Slot of another Core Board. This signal is used to switch JTAG and CLK sources.
Similarly, PRSNT_N is used on the Star Slot to detect another Core Board is connected. This signal is used to switch the JTAG chain signals.
 
CLK and RST_N are inputs to the Core Board from the Chain Connector and output from all Slots.